{
  "test": "RMSNorm Sign Symmetry (CORRECTED)",
  "date": "2025-11-05",
  "hypothesis": "RMSNorm after hooks creates sign symmetry, making +strength and -strength produce identical outputs",
  "model": "google/gemma-3-4b-pt",
  "concept": "person",
  "strength": 1.0,

  "bug_found": {
    "description": "Initial test had bug where vector was negated instead of applying sign to projection",
    "incorrect_formula": "v_signed = v * sign; steered = hidden - projection(v_signed)",
    "problem": "Sign gets squared away: (h·(-v))(-v) = (h·v)(v), making ±v identical",
    "correct_formula": "steered = hidden - (sign * projection(v))",
    "impact": "This bug would have made all directional steering ineffective"
  },

  "current_placement": {
    "description": "After layer completion (before next layer's RMSNorm)",
    "cosine_similarity": 0.9671,
    "outputs": {
      "positive": "Tell me about yourselfTell me about yourselfTell me about yourselfTell me about",
      "negative": "Tell me about the 1.1.1.1.\n\nI'm a 1.1.1.1.\n\nI'm a"
    },
    "identical": false,
    "quality": "both_somewhat_degenerate",
    "symmetry": "strong (cos=0.97)"
  },

  "proposed_placement": {
    "description": "Before MLP (steering participates in nonlinearity)",
    "cosine_similarity": 0.1535,
    "outputs": {
      "positive": "Tell me about the 1990's.\n\n[User 0001]\n\nI'm 13 now, and a",
      "negative": "Tell me about your experience with the new iPhone SE? Did you buy it? Did you up"
    },
    "identical": false,
    "quality": "both_coherent_and_different",
    "symmetry": "weak (cos=0.15)"
  },

  "conclusion": {
    "hypothesis_confirmed": true,
    "sign_symmetry_reduced_by": 0.8136,
    "hook_placement_critical": true,
    "notes": [
      "CRITICAL BUG FIXED: Negating vector squares away the sign in projection formula",
      "Current placement (after layer): STRONG symmetry (cos=0.97) - RMSNorm issue confirmed",
      "Proposed placement (before MLP): WEAK symmetry (cos=0.15) - 81% improvement!",
      "Hook placement dramatically affects steering effectiveness",
      "Both placements produce different outputs now (bug was masking this)",
      "Proposed placement produces more coherent and distinct outputs"
    ]
  },

  "recommendations": [
    "Use 'before MLP' hook placement for better directional control",
    "NEVER negate the vector itself - always apply sign to the projection operation",
    "Current placement may still be usable but has higher sign symmetry",
    "Audit all steering code to ensure correct sign application"
  ],

  "code_audit": {
    "status": "PASSED",
    "checked": [
      "src/steering/hooks.py - CORRECT (uses strength * projection)",
      "src/steering/manifold.py - CORRECT (uses strength * projection)"
    ],
    "bug_was_only_in": [
      "scripts/test_rmsnorm_symmetry.py (FIXED)"
    ]
  }
}
