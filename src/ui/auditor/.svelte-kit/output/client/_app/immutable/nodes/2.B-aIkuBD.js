import{d as ft,f as n,a as v,s as l,c as Ia}from"../chunks/BGMlQYQP.js";import{o as Wa,p as mt,A as _a,B as qa,a as xt,i as a,g as e,s,t as $,f as bt,C as ea,h as t,j as sa,z as K,D as kt,k as xa}from"../chunks/DN0K50FJ.js";import{i as k,s as yt,a as pa}from"../chunks/BMmI4BWs.js";import{t as $t,a as ra,r as Tt,e as E,i as J,s as St}from"../chunks/BkaXrk5i.js";import{a as Ja,b as At}from"../chunks/DS2Ya--X.js";import{b as wt}from"../chunks/CaPF1CxJ.js";import{b as jt,t as Ot,f as Ct,l as Ft,g as It,h as Nt,j as Lt}from"../chunks/DwvWJRcu.js";function Mt(X,va,Z,da){var H=X.__style;if(Wa||H!==va){var G=$t(va);(!Wa||G!==X.getAttribute("style"))&&(G==null?X.removeAttribute("style"):X.style.cssText=G),X.__style=va}return da}var Rt=n('<label class="svelte-1uha8ag"><input type="checkbox"/> Auto-scroll</label> <button class="svelte-1uha8ag">Clear</button> <span class="tick-count svelte-1uha8ag"> </span>',1),Vt=n('<button class="svelte-1uha8ag">Refresh</button> <span class="tick-count svelte-1uha8ag"> </span>',1),Dt=n('<span class="tick-tier svelte-1uha8ag"> </span>'),Et=n('<span class="content-text svelte-1uha8ag"> </span>'),Ht=n('<span class="activation svelte-1uha8ag"> </span>'),Bt=n('<div class="tick-activations svelte-1uha8ag"></div>'),Gt=n('<span class="violation svelte-1uha8ag"> </span>'),zt=n('<div class="tick-violations svelte-1uha8ag"></div>'),Ut=n('<div><div class="tick-header svelte-1uha8ag"><span class="tick-id svelte-1uha8ag"> </span> <span class="tick-time svelte-1uha8ag"> </span> <span class="tick-type svelte-1uha8ag"> </span> <!></div> <div class="tick-content svelte-1uha8ag"><!></div> <!> <!></div>'),Wt=n('<div class="empty-state svelte-1uha8ag"><p>Waiting for experience stream...</p> <p class="hint svelte-1uha8ag">Generate text to see ticks appear here.</p></div>'),qt=n("<!> <!>",1),Jt=n('<div class="empty-state svelte-1uha8ag"><p>Loading audit records...</p></div>'),Kt=n('<div class="empty-state svelte-1uha8ag"><p>No audit records found</p> <p class="hint svelte-1uha8ag">Audit records are created during BE inference.</p></div>'),Pt=n('<span class="content-text svelte-1uha8ag"> </span>'),Qt=n('<span class="activation svelte-1uha8ag"> </span>'),Xt=n('<div class="tick-activations svelte-1uha8ag"></div>'),Yt=n('<span class="steering-tag svelte-1uha8ag"> </span>'),Zt=n('<div class="tick-steering svelte-1uha8ag"></div>'),ae=n('<div><div class="tick-header svelte-1uha8ag"><span class="tick-id svelte-1uha8ag"> </span> <span class="tick-time svelte-1uha8ag"> </span> <span class="tick-type svelte-1uha8ag"> </span> <span class="record-hash svelte-1uha8ag"> </span></div> <div class="tick-content svelte-1uha8ag"><!></div> <!> <!></div>'),te=n('<p class="empty svelte-1uha8ag">No concept data yet</p>'),ee=n('<div class="concept-row svelte-1uha8ag"><span class="concept-name svelte-1uha8ag"> </span> <span class="concept-stats svelte-1uha8ag"><span class="avg svelte-1uha8ag"> </span> <span> </span> <span class="count svelte-1uha8ag"> </span></span></div>'),se=n('<div class="concept-list svelte-1uha8ag"></div>'),re=n("<span> </span>"),ve=n('<div class="simplex-item svelte-1uha8ag"><span class="term svelte-1uha8ag"> </span> <span class="value svelte-1uha8ag"> </span> <!></div>'),ie=n('<h4 class="svelte-1uha8ag">Simplex</h4> <div class="simplex-list svelte-1uha8ag"></div>',1),ne=n('<div class="detail-grid svelte-1uha8ag"><span class="label svelte-1uha8ag">ID:</span> <span> </span> <span class="label svelte-1uha8ag">Type:</span> <span> </span> <span class="label svelte-1uha8ag">State:</span> <span> </span> <span class="label svelte-1uha8ag">Tier:</span> <span> </span> <span class="label svelte-1uha8ag">H-Norm:</span> <span> </span></div> <!>',1),le=n('<p class="empty svelte-1uha8ag">No ticks yet</p>'),oe=n('<span class="badge svelte-1uha8ag"> </span>'),ce=n('<div class="alert violation svelte-1uha8ag"><span class="alert-type svelte-1uha8ag">VIOLATION</span> <span class="alert-term svelte-1uha8ag"> </span> <span class="alert-value svelte-1uha8ag"> </span></div>'),_e=n('<div class="alert-list svelte-1uha8ag"></div>'),pe=n('<div class="alert steering svelte-1uha8ag"><span class="alert-type svelte-1uha8ag">STEERING</span> <span class="alert-term svelte-1uha8ag"> </span> <span class="alert-value svelte-1uha8ag"> </span></div>'),de=n('<div class="alert-list svelte-1uha8ag"></div>'),ue=n('<p class="empty svelte-1uha8ag">No alerts</p>'),ge=n('<button class="clear-btn svelte-1uha8ag">Clear</button>'),he=n('<div class="panel latest-tick svelte-1uha8ag"><h3 class="svelte-1uha8ag">Latest Tick</h3> <!></div> <div class="panel alerts svelte-1uha8ag"><h3 class="svelte-1uha8ag">Alerts <!></h3> <!> <!> <!> <!></div>',1),fe=n('<p class="empty svelte-1uha8ag">No checkpoints</p>'),me=n('<span class="cp-concept svelte-1uha8ag"> </span>'),xe=n('<div class="cp-concepts svelte-1uha8ag"></div>'),be=n('<div class="cp-steering svelte-1uha8ag"> </div>'),ke=n('<div class="checkpoint-item svelte-1uha8ag"><div class="cp-header svelte-1uha8ag"><span class="cp-range svelte-1uha8ag"> </span> <span class="cp-count svelte-1uha8ag"> </span></div> <div class="cp-time svelte-1uha8ag"> </div> <!> <!></div>'),ye=n('<div class="checkpoint-list svelte-1uha8ag"></div>'),$e=n('<div class="panel checkpoints svelte-1uha8ag"><h3 class="svelte-1uha8ag"> </h3> <!></div>'),Te=n('<div class="stream-page svelte-1uha8ag"><div class="controls svelte-1uha8ag"><div class="view-toggle svelte-1uha8ag"><button>Experience Stream</button> <button>CAT Audit Log</button></div> <div class="control-buttons svelte-1uha8ag"><!></div></div> <div class="panels svelte-1uha8ag"><div class="stream-panel svelte-1uha8ag"><!></div> <div class="sidebar svelte-1uha8ag"><div class="panel concept-summary svelte-1uha8ag"><h3 class="svelte-1uha8ag">Concept Summary</h3> <!></div> <!></div></div></div>');function Ie(X,va){mt(va,!0);const Z=()=>pa(Ot,"$ticks",ia),da=()=>pa(jt,"$bedStatus",ia),H=()=>pa(Ft,"$latestTick",ia),G=()=>pa(It,"$recentViolations",ia),ua=()=>pa(Nt,"$recentSteering",ia),[ia,Ka]=yt();let P=_a("stream"),na=_a(qa([])),ga=_a(qa([])),ba=_a(!1),Na="default-cat",ka=_a(!0),la,La=sa(()=>{const r=a(P)==="stream"?Z():a(na),i={};for(const o of r.slice(-100)){const p=a(P)==="stream"?o.concept_activations:o.probe_activations;for(const[f,c]of Object.entries(p))i[f]||(i[f]={total:0,max:0,count:0,recent:[]}),i[f].total+=c,i[f].max=Math.max(i[f].max,c),i[f].count+=1,i[f].recent.push(c),i[f].recent.length>10&&i[f].recent.shift()}return Object.entries(i).map(([o,p])=>{const f=p.total/p.count,c=p.recent;let u="stable";if(c.length>=3){const b=c.slice(0,Math.floor(c.length/2)),A=c.slice(Math.floor(c.length/2)),M=b.reduce((T,F)=>T+F,0)/b.length,m=A.reduce((T,F)=>T+F,0)/A.length;m>M*1.1?u="rising":m<M*.9&&(u="falling")}return{concept_id:o,total_activations:p.total,avg_score:f,max_score:p.max,tick_count:p.count,trend:u}}).sort((o,p)=>p.avg_score-o.avg_score).slice(0,15)});async function Ma(){var i;const r=((i=da())==null?void 0:i.xdb_id)??"xdb-default";ea(ba,!0);try{const o=await Ja.getRecords(Na,r,100);ea(na,o.records??[],!0)}catch(o){console.error("Failed to load audit records:",o)}finally{ea(ba,!1)}}async function Pa(){var i;const r=((i=da())==null?void 0:i.xdb_id)??"xdb-default";try{const o=await Ja.getCheckpoints(Na,r);ea(ga,o.checkpoints??[],!0)}catch(o){console.error("Failed to load checkpoints:",o)}}function Ra(r){ea(P,r,!0),r==="audit"&&(Ma(),Pa())}xt(()=>{a(ka)&&la&&Z().length>0&&(la.scrollTop=la.scrollHeight)});function ya(r){return new Date(r).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}function Va(r){return{input:"type-input",output:"type-output",introspect:"type-introspect",steering:"type-steering",workspace:"type-workspace",system:"type-system"}[r]||""}function Qa(r){return Object.entries(r.concept_activations).sort((o,p)=>p[1]-o[1]).slice(0,3)}function Xa(r){return r==="rising"?"↑":r==="falling"?"↓":"→"}var $a=Te(),Ta=e($a),Sa=e(Ta),Aa=e(Sa);Aa.__click=()=>Ra("stream");let Da;var Ea=s(Aa,2);Ea.__click=()=>Ra("audit");let Ha;t(Sa);var Ba=s(Sa,2),Ya=e(Ba);{var Za=r=>{var i=Rt(),o=K(i),p=e(o);Tt(p),kt(),t(o);var f=s(o,2);f.__click=()=>Ct();var c=s(f,2),u=e(c);t(c),$(()=>l(u,`${Z().length??""} ticks`)),At(p,()=>a(ka),b=>ea(ka,b)),v(r,i)},at=r=>{var i=Vt(),o=K(i);o.__click=Ma;var p=s(o,2),f=e(p);t(p),$(()=>l(f,`${a(na).length??""} records`)),v(r,i)};k(Ya,r=>{a(P)==="stream"?r(Za):r(at,!1)})}t(Ba),t(Ta);var Ga=s(Ta,2),ha=e(Ga),tt=e(ha);{var et=r=>{var i=qt(),o=K(i);E(o,1,Z,c=>c.tick_id,(c,u)=>{var b=Ut(),A=e(b),M=e(A),m=e(M);t(M);var T=s(M,2),F=e(T,!0);t(T);var I=s(T,2),S=e(I,!0);t(I);var R=s(I,2);{var B=d=>{var _=Dt(),C=e(_);t(_),$(()=>l(C,`T${a(u).tier??""}`)),v(d,_)};k(R,d=>{a(u).tier!==null&&d(B)})}t(A);var V=s(A,2),g=e(V);{var h=d=>{var _=Et(),C=e(_,!0);t(_),$(()=>l(C,a(u).content)),v(d,_)};k(g,d=>{a(u).content&&d(h)})}t(V);var N=s(V,2);{var O=d=>{var _=Bt();E(_,21,()=>Qa(a(u)),J,(C,w)=>{var D=sa(()=>xa(a(w),2));let z=()=>a(D)[0],U=()=>a(D)[1];var W=Ht(),j=e(W);t(W),$(y=>{Mt(W,`opacity: ${.3+U()*.7}`),l(j,`${z()??""}: ${y??""}`)},[()=>U().toFixed(2)]),v(C,W)}),t(_),v(d,_)};k(N,d=>{Object.keys(a(u).concept_activations).length>0&&d(O)})}var L=s(N,2);{var x=d=>{var _=zt();E(_,21,()=>a(u).hush_violations,J,(C,w)=>{var D=Gt(),z=e(D);t(D),$(()=>l(z,`! ${a(w).simplex_term??""}`)),v(C,D)}),t(_),v(d,_)};k(L,d=>{a(u).hush_violations.length>0&&d(x)})}t(b),$((d,_)=>{ra(b,1,`tick ${d??""}`,"svelte-1uha8ag"),l(m,`#${a(u).tick_id??""}`),l(F,_),l(S,a(u).tick_type)},[()=>Va(a(u).tick_type),()=>ya(a(u).timestamp)]),v(c,b)});var p=s(o,2);{var f=c=>{var u=Wt();v(c,u)};k(p,c=>{Z().length===0&&c(f)})}v(r,i)},st=r=>{var i=Ia(),o=K(i);{var p=c=>{var u=Jt();v(c,u)},f=c=>{var u=Ia(),b=K(u);{var A=m=>{var T=Kt();v(m,T)},M=m=>{var T=Ia(),F=K(T);E(F,17,()=>a(na),I=>I.id,(I,S)=>{var R=ae(),B=e(R),V=e(B),g=e(V);t(V);var h=s(V,2),N=e(h,!0);t(h);var O=s(h,2),L=e(O,!0);t(O);var x=s(O,2),d=e(x);t(x),t(B);var _=s(B,2),C=e(_);{var w=j=>{var y=Pt(),q=e(y,!0);t(y),$(()=>l(q,a(S).raw_content)),v(j,y)};k(C,j=>{a(S).raw_content&&j(w)})}t(_);var D=s(_,2);{var z=j=>{var y=Xt();E(y,21,()=>Object.entries(a(S).probe_activations).slice(0,5),J,(q,aa)=>{var Q=sa(()=>xa(a(aa),2));let oa=()=>a(Q)[0],fa=()=>a(Q)[1];var ta=Qt(),ja=e(ta);t(ta),$(Y=>l(ja,`${oa()??""}: ${Y??""}`),[()=>fa().toFixed(2)]),v(q,ta)}),t(y),v(j,y)};k(D,j=>{Object.keys(a(S).probe_activations).length>0&&j(z)})}var U=s(D,2);{var W=j=>{var y=Zt();E(y,21,()=>a(S).steering_applied,J,(q,aa)=>{var Q=Yt(),oa=e(Q);t(Q),$(()=>l(oa,`⟳ ${a(aa).simplex_term??""}`)),v(q,Q)}),t(y),v(j,y)};k(U,j=>{a(S).steering_applied.length>0&&j(W)})}t(R),$((j,y,q)=>{ra(R,1,`tick ${j??""}`,"svelte-1uha8ag"),l(g,`#${a(S).tick??""}`),l(N,y),l(L,a(S).event_type),St(x,"title",a(S).record_hash),l(d,`#${q??""}`)},[()=>Va(a(S).event_type),()=>ya(a(S).timestamp),()=>a(S).record_hash.slice(0,8)]),v(I,R)}),v(m,T)};k(b,m=>{a(na).length===0?m(A):m(M,!1)},!0)}v(c,u)};k(o,c=>{a(ba)?c(p):c(f,!1)})}v(r,i)};k(tt,r=>{a(P)==="stream"?r(et):r(st,!1)})}t(ha),wt(ha,r=>la=r,()=>la);var za=s(ha,2),wa=e(za),rt=s(e(wa),2);{var vt=r=>{var i=te();v(r,i)},it=r=>{var i=se();E(i,21,()=>a(La),J,(o,p)=>{var f=ee(),c=e(f),u=e(c,!0);t(c);var b=s(c,2),A=e(b),M=e(A,!0);t(A);var m=s(A,2);let T;var F=e(m,!0);t(m);var I=s(m,2),S=e(I);t(I),t(b),t(f),$((R,B)=>{l(u,a(p).concept_id),l(M,R),T=ra(m,1,"trend svelte-1uha8ag",null,T,{rising:a(p).trend==="rising",falling:a(p).trend==="falling"}),l(F,B),l(S,`(${a(p).tick_count??""})`)},[()=>a(p).avg_score.toFixed(2),()=>Xa(a(p).trend)]),v(o,f)}),t(i),v(r,i)};k(rt,r=>{a(La).length===0?r(vt):r(it,!1)})}t(wa);var nt=s(wa,2);{var lt=r=>{var i=he(),o=K(i),p=s(e(o),2);{var f=g=>{var h=ne(),N=K(h),O=s(e(N),2),L=e(O);t(O);var x=s(O,4),d=e(x,!0);t(x);var _=s(x,4),C=e(_,!0);t(_);var w=s(_,4),D=e(w,!0);t(w);var z=s(w,4),U=e(z,!0);t(z),t(N);var W=s(N,2);{var j=y=>{var q=ie(),aa=s(K(q),2);E(aa,5,()=>Object.entries(H().simplex_activations),J,(Q,oa)=>{var fa=sa(()=>xa(a(oa),2));let ta=()=>a(fa)[0],ja=()=>a(fa)[1];const Y=sa(()=>H().simplex_deviations[ta()]);var Oa=ve(),Ca=e(Oa),ct=e(Ca,!0);t(Ca);var Fa=s(Ca,2),_t=e(Fa,!0);t(Fa);var pt=s(Fa,2);{var dt=ca=>{var ma=re();let Ua;var ut=e(ma);t(ma),$((gt,ht)=>{Ua=ra(ma,1,"deviation svelte-1uha8ag",null,Ua,gt),l(ut,`${a(Y)>0?"+":""}${ht??""}σ`)},[()=>({warning:Math.abs(a(Y))>1.5}),()=>a(Y).toFixed(2)]),v(ca,ma)};k(pt,ca=>{a(Y)!==null&&a(Y)!==void 0&&ca(dt)})}t(Oa),$(ca=>{l(ct,ta()),l(_t,ca)},[()=>ja().toFixed(3)]),v(Q,Oa)}),t(aa),v(y,q)};k(W,y=>{Object.keys(H().simplex_activations).length>0&&y(j)})}$(y=>{l(L,`#${H().tick_id??""}`),l(d,H().tick_type),l(C,H().workspace_state||"-"),l(D,H().tier??"-"),l(U,y)},[()=>{var y;return((y=H().hidden_state_norm)==null?void 0:y.toFixed(2))||"-"}]),v(g,h)},c=g=>{var h=le();v(g,h)};k(p,g=>{H()?g(f):g(c,!1)})}t(o);var u=s(o,2),b=e(u),A=s(e(b));{var M=g=>{var h=oe(),N=e(h,!0);t(h),$(()=>l(N,G().length)),v(g,h)};k(A,g=>{G().length>0&&g(M)})}t(b);var m=s(b,2);{var T=g=>{var h=_e();E(h,5,()=>G().slice(-5),J,(N,O)=>{var L=ce(),x=s(e(L),2),d=e(x,!0);t(x);var _=s(x,2),C=e(_);t(_),t(L),$(w=>{l(d,a(O).simplex_term),l(C,`${w??""}σ`)},[()=>{var w;return(w=a(O).deviation)==null?void 0:w.toFixed(2)}]),v(N,L)}),t(h),v(g,h)};k(m,g=>{G().length>0&&g(T)})}var F=s(m,2);{var I=g=>{var h=de();E(h,5,()=>ua().slice(-5),J,(N,O)=>{var L=pe(),x=s(e(L),2),d=e(x,!0);t(x);var _=s(x,2),C=e(_);t(_),t(L),$(w=>{l(d,a(O).simplex_term),l(C,`×${w??""}`)},[()=>a(O).strength.toFixed(2)]),v(N,L)}),t(h),v(g,h)};k(F,g=>{ua().length>0&&g(I)})}var S=s(F,2);{var R=g=>{var h=ue();v(g,h)};k(S,g=>{G().length===0&&ua().length===0&&g(R)})}var B=s(S,2);{var V=g=>{var h=ge();h.__click=()=>Lt(),v(g,h)};k(B,g=>{(G().length>0||ua().length>0)&&g(V)})}t(u),v(r,i)},ot=r=>{var i=$e(),o=e(i),p=e(o);t(o);var f=s(o,2);{var c=b=>{var A=fe();v(b,A)},u=b=>{var A=ye();E(A,21,()=>a(ga).slice(0,10),J,(M,m)=>{var T=ke(),F=e(T),I=e(F),S=e(I);t(I);var R=s(I,2),B=e(R);t(R),t(F);var V=s(F,2),g=e(V,!0);t(V);var h=s(V,2);{var N=x=>{var d=xe();E(d,21,()=>Object.entries(a(m).top_k_activations).slice(0,3),J,(_,C)=>{var w=sa(()=>xa(a(C),2));let D=()=>a(w)[0],z=()=>a(w)[1];var U=me(),W=e(U);t(U),$(j=>l(W,`${D()??""}: ${j??""}`),[()=>z().toFixed(2)]),v(_,U)}),t(d),v(x,d)};k(h,x=>{Object.keys(a(m).top_k_activations).length>0&&x(N)})}var O=s(h,2);{var L=x=>{var d=be(),_=e(d);t(d),$(()=>l(_,`${a(m).steering_count??""} steering events`)),v(x,d)};k(O,x=>{a(m).steering_count>0&&x(L)})}t(T),$(x=>{l(S,`#${a(m).start_tick??""}-#${a(m).end_tick??""}`),l(B,`${a(m).record_count??""} records`),l(g,x)},[()=>ya(a(m).timestamp)]),v(M,T)}),t(A),v(b,A)};k(f,b=>{a(ga).length===0?b(c):b(u,!1)})}t(i),$(()=>l(p,`Checkpoints (${a(ga).length??""})`)),v(r,i)};k(nt,r=>{a(P)==="stream"?r(lt):r(ot,!1)})}t(za),t(Ga),t($a),$(()=>{Da=ra(Aa,1,"svelte-1uha8ag",null,Da,{active:a(P)==="stream"}),Ha=ra(Ea,1,"svelte-1uha8ag",null,Ha,{active:a(P)==="audit"})}),v(X,$a),bt(),Ka()}ft(["click"]);export{Ie as component};
