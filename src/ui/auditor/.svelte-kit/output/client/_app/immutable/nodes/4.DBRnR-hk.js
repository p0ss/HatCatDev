import{d as Ut,f as _,a as c,s as l,c as Vt}from"../chunks/BGMlQYQP.js";import{m as Yt,e as Zt,F as te,G as ee,H as ae,I as se,v as ot,x as re,p as ie,A as w,B as Tt,a as ve,i as e,g as s,s as i,t as B,f as le,C as n,j as $t,h as a,z as ne,k as oe}from"../chunks/DN0K50FJ.js";import{i as F,s as pe,a as ce}from"../chunks/BMmI4BWs.js";import{r as _e,e as pt,i as ct,a as ue}from"../chunks/BkaXrk5i.js";import{c as de,x as _t}from"../chunks/DS2Ya--X.js";import{b as fe}from"../chunks/DwvWJRcu.js";function Bt(r,o,T=!1){if(r.multiple){if(o==null)return;if(!ee(o))return ae();for(var f of r.options)f.selected=o.includes(O(f));return}for(f of r.options){var x=O(f);if(se(x,o)){f.selected=!0;return}}(!T||o!==void 0)&&(r.selectedIndex=-1)}function me(r){var o=new MutationObserver(()=>{Bt(r,r.__value)});o.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),te(()=>{o.disconnect()})}function qt(r,o,T=o){var f=new WeakSet,x=!0;Yt(r,"change",p=>{var m=p?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(m),O);else{var g=r.querySelector(m)??r.querySelector("option:not([disabled])");u=g&&O(g)}T(u),ot!==null&&f.add(ot)}),Zt(()=>{var p=o();if(r===document.activeElement){var m=re??ot;if(f.has(m))return}if(Bt(r,p,x),x&&p===void 0){var u=r.querySelector(":checked");u!==null&&(p=O(u),T(p))}r.__value=p,x=!1}),me(r)}function O(r){return"__value"in r?r.__value:r.value}var he=_('<div class="error-banner svelte-4p4iat"> </div>'),be=_('<p class="loading svelte-4p4iat">Loading...</p>'),ge=_('<p class="empty svelte-4p4iat">No timesteps found</p>'),ye=_('<span class="concept-tag svelte-4p4iat"> </span>'),xe=_('<div class="ts-concepts svelte-4p4iat"></div>'),ke=_('<div class="timestep-item svelte-4p4iat"><div class="ts-header svelte-4p4iat"><span class="ts-tick svelte-4p4iat"> </span> <span class="ts-type svelte-4p4iat"> </span> <span class="ts-time svelte-4p4iat"> </span> <span class="ts-fidelity svelte-4p4iat"> </span></div> <div class="ts-content svelte-4p4iat"> </div> <!></div>'),Se=_('<div class="timestep-list svelte-4p4iat"></div>'),we=_('<p class="empty svelte-4p4iat">No tags found</p>'),Te=_('<span class="bud-status svelte-4p4iat"> </span>'),$e=_('<div><span class="tag-name svelte-4p4iat"> </span> <span class="tag-type svelte-4p4iat"> </span> <span class="tag-count svelte-4p4iat"> </span> <!></div>'),qe=_('<div class="tag-list svelte-4p4iat"></div>'),Be=_('<div class="xdb-page svelte-4p4iat"><div class="header svelte-4p4iat"><h2 class="svelte-4p4iat">XDB Browser</h2> <span class="xdb-id svelte-4p4iat"> </span></div> <div class="search-bar svelte-4p4iat"><input type="text" placeholder="Search content..." class="svelte-4p4iat"/> <button class="svelte-4p4iat">Search</button> <button class="svelte-4p4iat">Recent</button> <select class="svelte-4p4iat"><option>50</option><option>100</option><option>500</option></select></div> <!> <div class="content svelte-4p4iat"><div class="timesteps-panel svelte-4p4iat"><h3 class="svelte-4p4iat"> </h3> <!></div> <div class="tags-panel svelte-4p4iat"><h3 class="svelte-4p4iat"> </h3> <div class="tag-filters svelte-4p4iat"><select class="svelte-4p4iat"><option>All types</option><option>Concept</option><option>Entity</option><option>Bud</option><option>Custom</option></select></div> <!></div></div></div>');function Ie(r,o){ie(o,!0);const T=()=>ce(fe,"$bedStatus",f),[f,x]=pe();let p=$t(()=>{var t;return((t=T())==null?void 0:t.xdb_id)??"xdb-default"}),m=w(Tt([])),u=w(Tt([])),g=w(!1),$=w(null),R=w(""),G=w(""),D=w(100);async function H(){n(g,!0),n($,null);try{const t=await _t.getRecent(e(p),e(D));n(m,t.timesteps??[],!0)}catch(t){n($,String(t),!0)}finally{n(g,!1)}}async function ut(){try{const t=await _t.getTags(e(p),e(G)||void 0);n(u,t.tags??[],!0)}catch(t){console.error("Failed to load tags:",t)}}async function dt(){if(!e(R).trim()){H();return}n(g,!0),n($,null);try{const t=await _t.query(e(p),{text_search:e(R),limit:e(D)});n(m,t.timesteps??[],!0)}catch(t){n($,String(t),!0)}finally{n(g,!1)}}function Ft(t){return new Date(t).toLocaleString()}ve(()=>{e(p)&&(H(),ut())});var M=Be(),W=s(M),ft=i(s(W),2),Lt=s(ft,!0);a(ft),a(W);var X=i(W,2),N=s(X);_e(N),N.__keydown=t=>t.key==="Enter"&&dt();var mt=i(N,2);mt.__click=dt;var ht=i(mt,2);ht.__click=H;var J=i(ht,2),K=s(J);K.value=K.__value=50;var P=i(K);P.value=P.__value=100;var bt=i(P);bt.value=bt.__value=500,a(J),a(X);var gt=i(X,2);{var jt=t=>{var v=he(),L=s(v,!0);a(v),B(()=>l(L,e($))),c(t,v)};F(gt,t=>{e($)&&t(jt)})}var yt=i(gt,2),Q=s(yt),U=s(Q),At=s(U);a(U);var Ct=i(U,2);{var Et=t=>{var v=be();c(t,v)},It=t=>{var v=Vt(),L=ne(v);{var y=h=>{var b=ge();c(h,b)},q=h=>{var b=Se();pt(b,21,()=>e(m),ct,(st,d)=>{var j=ke(),k=s(j),A=s(k),rt=s(A);a(A);var C=i(A,2),E=s(C,!0);a(C);var S=i(C,2),it=s(S,!0);a(S);var St=i(S,2),zt=s(St,!0);a(St),a(k);var vt=i(k,2),Gt=s(vt,!0);a(vt);var Ht=i(vt,2);{var Mt=I=>{var lt=xe();pt(lt,21,()=>Object.entries(e(d).concept_activations).slice(0,5),ct,(Wt,Xt)=>{var wt=$t(()=>oe(e(Xt),2));let Jt=()=>e(wt)[0],Kt=()=>e(wt)[1];var nt=ye(),Pt=s(nt);a(nt),B(Qt=>l(Pt,`${Jt()??""}: ${Qt??""}`),[()=>Kt().toFixed(2)]),c(Wt,nt)}),a(lt),c(I,lt)};F(Ht,I=>{Object.keys(e(d).concept_activations||{}).length>0&&I(Mt)})}a(j),B(I=>{l(rt,`#${e(d).tick??""}`),l(E,e(d).event_type),l(it,I),l(zt,e(d).fidelity),l(Gt,e(d).content||"(empty)")},[()=>Ft(e(d).timestamp)]),c(st,j)}),a(b),c(h,b)};F(L,h=>{e(m).length===0?h(y):h(q,!1)},!0)}c(t,v)};F(Ct,t=>{e(g)?t(Et):t(It,!1)})}a(Q);var xt=i(Q,2),V=s(xt),Ot=s(V);a(V);var Y=i(V,2),z=s(Y);z.__change=ut;var Z=s(z);Z.value=Z.__value="";var tt=i(Z);tt.value=tt.__value="concept";var et=i(tt);et.value=et.__value="entity";var at=i(et);at.value=at.__value="bud";var kt=i(at);kt.value=kt.__value="custom",a(z),a(Y);var Rt=i(Y,2);{var Dt=t=>{var v=we();c(t,v)},Nt=t=>{var v=qe();pt(v,21,()=>e(u),ct,(L,y)=>{var q=$e();let h;var b=s(q),st=s(b,!0);a(b);var d=i(b,2),j=s(d,!0);a(d);var k=i(d,2),A=s(k);a(k);var rt=i(k,2);{var C=E=>{var S=Te(),it=s(S,!0);a(S),B(()=>l(it,e(y).bud_status)),c(E,S)};F(rt,E=>{e(y).bud_status&&E(C)})}a(q),B(()=>{h=ue(q,1,"tag-item svelte-4p4iat",null,h,{bud:e(y).tag_type==="bud"}),l(st,e(y).name),l(j,e(y).tag_type),l(A,`${e(y).use_count??""} uses`)}),c(L,q)}),a(v),c(t,v)};F(Rt,t=>{e(u).length===0?t(Dt):t(Nt,!1)})}a(xt),a(yt),a(M),B(()=>{l(Lt,e(p)),l(At,`Timesteps (${e(m).length??""})`),l(Ot,`Tags (${e(u).length??""})`)}),de(N,()=>e(R),t=>n(R,t)),qt(J,()=>e(D),t=>n(D,t)),qt(z,()=>e(G),t=>n(G,t)),c(r,M),le(),x()}Ut(["keydown","click","change"]);export{Ie as component};
